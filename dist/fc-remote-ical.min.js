"use strict";/**
 * Allows importing remote iCalendars into FullCalendar.
 * Based on https://github.com/2733/icalendar2fullcalendar.
 * @author Carlos García (carlosgarcia.engineer)
 * @copyright Carlos García 2016
 * @license MIT
 * @module cgalvarez/fc-remote-ical
 * @requires mozilla-comm/ical.js
 * @version 1.0.0
 */
var FCRemoteIcal=function(){function e(){}return Object.defineProperty(e,"STYLES_DEBUG_HIGHLIGHTED",{get:function(){return"font-weight: bold; color: indigo;"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"STYLES_DEBUG",{get:function(){return"font-weight: bold; color: blue;"},enumerable:!0,configurable:!0}),e["import"]=function(n,t){if(n&&t.length){e._$fc=n,e._queue=t.length,e._recurringEvents=[];for(var r=function(t){jQuery.get(t.url,null,function(r){n.fullCalendar("addEventSource",e._parseCalendar(r,t.defaults)),e._dequeue()},"text")},o=0,u=t;o<u.length;o++){var a=u[o];r(a)}}},e._dequeue=function(){--e._queue||e._$fc.fullCalendar("addEventSource",e._expandRecurringEvents)},e._parseCalendar=function(n,t){var r=[],o=function(n){e._parseEvent(n,function(n){r.push(e._mergeEventOptions(n,t))})},u=function(n){n.defaults=t,e._recurringEvents.push(n)};return e._parseEvents(n,o,u),r},e._parseEvents=function(e,n,t){for(var r=ICAL.parse(e),o=new ICAL.Component(r),u=o.getAllSubcomponents(Tag.EVENT),a=0,i=u;a<i.length;a++){var c=i[a];c.hasProperty(Tag.RECURRING_RULE)?t(c):n(c)}},e._randomQuickUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0,t="x"===e?n:3&n|8;return t.toString(16)})},e._randomUUID=function(){var n,t,r,o,u=e._lookUpTable;if(window&&window.crypto&&window.crypto.getRandomValues){var a=new Uint32Array(4);window.crypto.getRandomValues(a),n=a[0],t=a[1],r=a[2],o=a[3]}else n=4294967296*Math.random()>>>0,t=4294967296*Math.random()>>>0,r=4294967296*Math.random()>>>0,o=4294967296*Math.random()>>>0;return u[255&n]+u[n>>8&255]+u[n>>16&255]+u[n>>24&255]+"-"+u[255&t]+u[t>>8&255]+"-"+u[t>>16&15|64]+u[t>>24&255]+"-"+u[63&r|128]+u[r>>8&255]+"-"+u[r>>16&255]+u[r>>24&255]+u[255&o]+u[o>>8&255]+u[o>>16&255]+u[o>>24&255]},e._parseEvent=function(n,t){var r,o,u=n.getFirstPropertyValue(Tag.UID).toString()||e._randomUUID(),a=(u||"").replace(/[^\w\s]/gi,""),i=!1;try{r=moment(n.getFirstPropertyValue(Tag.TIME_START).toJSDate())}catch(c){return void console.debug("Undefined '%s', %s skipped (%s: %c%s%c).",Tag.TIME_START,Tag.EVENT,Tag.UID,e.STYLES_DEBUG_HIGHLIGHTED,u,e.STYLES_DEBUG)}try{o=moment(n.getFirstPropertyValue(Tag.TIME_END).toJSDate())}catch(c){i=!0}var f={id:u,title:n.getFirstPropertyValue(Tag.SUMMARY)||"",start:r,end:o,allDay:i,className:["event-"+a]};t(f)},e._mergeEventOptions=function(e,n){for(var t in n)"className"===t?e[t]=e[t].concat(n[t]):e[t]||(e[t]=n[t]);return e},e._momentIcalTime=function(e,n){return(new ICAL.Time).fromJSDate(e.toDate())},e._expandRecurringEvents=function(n,t,r,o){for(var u=[],a=function(o){var a=o.defaults;delete o.defaults,e._expandRecurringEvent(o,e._momentIcalTime(n,r),e._momentIcalTime(t,r),function(n){e._parseEvent(n,function(n){e._mergeEventOptions(n,{className:["recurring"]}),u.push(e._mergeEventOptions(n,a))})})},i=0,c=e._recurringEvents;i<c.length;i++){var f=c[i];a(f)}o(u)},e._expandRecurringEvent=function(n,t,r,o){for(var u=new ICAL.RecurExpansion({component:n,dtstart:n.getFirstPropertyValue(Tag.TIME_START)}),a=e._eventDuration(n);!u.complete&&u.next()<r;)u.last>=t&&(n=new ICAL.Component(n.toJSON()),n.updatePropertyWithValue(Tag.TIME_START,u.last),n.updatePropertyWithValue(Tag.TIME_END,e._eventEnd(u.last,a)),o(n))},e._eventDuration=function(e){return new Date(e.getFirstPropertyValue(Tag.TIME_END).toJSDate()-e.getFirstPropertyValue(Tag.TIME_START).toJSDate()).getTime()},e._eventEnd=function(e,n){return(new ICAL.Time).fromJSDate(new Date(e.toJSDate().getTime()+n))},e._queue=0,e._$fc=null,e._recurringEvents=[],e._lookUpTable=function(){for(var e=[],n=0;n<256;n++)e[n]=(n<16?"0":"")+n.toString(16);return e}(),e}();exports.FCRemoteIcal=FCRemoteIcal;var Tag=function(){function e(){}return Object.defineProperty(e,"ACTION",{get:function(){return"action"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ATTENDEE",{get:function(){return"attendee"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CALENDAR",{get:function(){return"calendar"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CATEGORIES",{get:function(){return"categories"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CREATED",{get:function(){return"created"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DESCRIPTION",{get:function(){return"description"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EVENT",{get:function(){return"vevent"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LAST_MODIFIED",{get:function(){return"last-modified"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LOCATION",{get:function(){return"location"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RECURRING_RULE",{get:function(){return"rrule"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SEQUENCE",{get:function(){return"sequence"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"STATUS",{get:function(){return"status"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SUMMARY",{get:function(){return"summary"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TIME_END",{get:function(){return"dtend"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TIME_STAMP",{get:function(){return"dtstamp"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TIME_START",{get:function(){return"dtstart"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TRANSPARENCY",{get:function(){return"transp"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TRIGGER",{get:function(){return"trigger"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UID",{get:function(){return"uid"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"URL",{get:function(){return"url"},enumerable:!0,configurable:!0}),e}();